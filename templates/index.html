<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Piknik Vakti</title>
<link rel="stylesheet" href="{{ url_for('static', filename='app.css') }}">

<!-- âœ… Manifest ve Service Worker baÄŸlantÄ±larÄ± -->
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#FF6600">
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/service-worker.js');
  }
</script>

</head>
<body>
<div class="container">
  <div class="header">
    <h1>ğŸ“… Piknik Vakti</h1>
    <div class="lang">
      <a href="#" data-lang="tr" class="active">ğŸ‡¹ğŸ‡· TR</a>
      <a href="#" data-lang="en">ğŸ‡¬ğŸ‡§ EN</a>
    </div>
  </div>

  <div class="card">
    <h2 data-i18n="title_create">Oda oluÅŸtur veya katÄ±l</h2>
    <div class="row">
      <input id="name" placeholder="Ä°smin">
      <input id="date" type="datetime-local">
      <button id="create" class="primary" data-i18n="btn_create">Oda OluÅŸtur</button>
    </div>
    <hr class="soft">
    <div class="row">
      <input id="join-name" placeholder="Ä°smin (katÄ±l)">
      <input id="join-code" placeholder="4 haneli kod">
      <button id="join" class="primary" data-i18n="btn_join">Koda GÃ¶re KatÄ±l</button>
    </div>
    <footer class="small" data-i18n="hint">Kod sadece paylaÅŸÄ±lan kiÅŸilerle Ã§alÄ±ÅŸÄ±r.</footer>
  </div>

  <div class="card">
    <h2>ğŸ“˜ <span data-i18n="guide">KÄ±sa KullanÄ±m KÄ±lavuzu</span></h2>
    <ul class="small">
      <li data-i18n="g1">Oda oluÅŸturanda 4 haneli kod atanÄ±r ve owner olur.</li>
      <li data-i18n="g2">KatÄ±lan kullanÄ±cÄ± kod + ismini yazar.</li>
      <li data-i18n="g3">Durumlar: Eksik â†’ AyrÄ±lan â†’ Getirildi.</li>
    </ul>
  </div>

  <div class="card">
    <h2>ğŸ§º <span data-i18n="rooms">Odalar</span></h2>
    {% if rooms %}
      {% for r in rooms %}
        <div class="item">
          <div class="item-left">
            <div class="item-title">{{ r.date }}</div>
            <div class="item-meta">{{ r.items }} Ã¼rÃ¼n</div>
          </div>
          <div class="actions">
            <!-- â€œGÃ¶râ€ = sadece gÃ¶rÃ¼ntÃ¼leme -->
            <a class="btn" href="/room/{{ r.code }}?view=1" data-i18n="see">GÃ¶r</a>
            <span class="small" title="Oda kodu">{{ r.mask }}</span>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="small" data-i18n="no_rooms">HenÃ¼z oda yok.</div>
    {% endif %}
  </div>
</div>

<script>
const tr = {
  title_create:"Oda oluÅŸtur veya katÄ±l", btn_create:"Oda OluÅŸtur", btn_join:"Koda GÃ¶re KatÄ±l",
  hint:"Kod sadece paylaÅŸÄ±lan kiÅŸilerle Ã§alÄ±ÅŸÄ±r.", guide:"KÄ±sa KullanÄ±m KÄ±lavuzu",
  g1:"Oda oluÅŸturanda 4 haneli kod atanÄ±r ve owner olur.", g2:"KatÄ±lan kullanÄ±cÄ± kod + ismini yazar.",
  g3:"Durumlar: Eksik â†’ AyrÄ±lan â†’ Getirildi.", rooms:"Odalar", see:"GÃ¶r", no_rooms:"HenÃ¼z oda yok."
};
const en = {
  title_create:"Create or join a room", btn_create:"Create Room", btn_join:"Join by Code",
  hint:"Works only for people who get the shared code.", guide:"Quick User Guide",
  g1:"Creator gets a 4-digit code and becomes owner.", g2:"Joiners write code + name.",
  g3:"States: Needed â†’ Claimed â†’ Brought.", rooms:"Rooms", see:"View", no_rooms:"No rooms yet."
};

function setLang(lang){
  const t = lang==='en'?en:tr;
  document.querySelectorAll("[data-i18n]").forEach(el=>{
    el.textContent = t[el.dataset.i18n] || el.textContent;
  });
  document.querySelectorAll(".lang a").forEach(a=>a.classList.toggle("active", a.dataset.lang===lang));
  localStorage.setItem("lang", lang);
}

document.querySelectorAll(".lang a").forEach(a=>{
  a.onclick = (e)=>{ e.preventDefault(); setLang(a.dataset.lang); };
});
setLang(localStorage.getItem("lang")||"tr");

// Room create/join
function four(){return Math.floor(1000+Math.random()*9000).toString();}
async function createRoomOnServer(code, owner, date){
  await fetch("/api/room",{method:"POST",headers:{"Content-Type":"application/json"},
    body:JSON.stringify({code,owner,date})});
}
document.getElementById("create").onclick = async ()=>{
  const n = (document.getElementById("name").value||"").trim();
  if(!n){ alert("Ä°smini yaz / Enter your name"); return; }
  const d = document.getElementById("date").value;
  const code = four();
  await createRoomOnServer(code, n, d);
  location.href = `/room/${code}?username=${encodeURIComponent(n)}&lang=${localStorage.getItem("lang")||"tr"}`;
};
document.getElementById("join").onclick = ()=>{
  const n=(document.getElementById("join-name").value||"").trim();
  const c=(document.getElementById("join-code").value||"").trim();
  if(!n||!c){ alert("Ä°sim ve kod gerekli / Name & code required"); return; }
  location.href = `/room/${c}?username=${encodeURIComponent(n)}&lang=${localStorage.getItem("lang")||"tr"}`;
};
</script>
</body>
</html>
